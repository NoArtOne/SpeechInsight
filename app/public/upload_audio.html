<!DOCTYPE html>
<html>

<head>
    <title>Upload Audio</title>
</head>

<body>
    <h1>Upload Audio</h1>
    <form id="uploadForm" onsubmit="upload_audio(event)" enctype="multipart/form-data">
        <input type="file" name="file" accept=".mp3,.wav" required> <br><br>
        <input type="submit" value="Upload">
    </form>
    <p><a href="/user_profile">Back to Profile</a></p>
</body>
<!-- ДОБАВИТЬ ОГРАНИЧЕНИЕ ЗАГРУЗКИ ФАЙЛА 1 ГБ -->
</html>
<script>
    function upload_audio(event) {
        event.preventDefault();

        const form = document.getElementById('uploadForm'); // Get the form element by its ID
        const formData = new FormData(form); // Create FormData object from the form

        fetch("/api/audios", {
            method: 'POST',
            body: formData,
            headers: {
                Authorization: `Bearer ${localStorage.getItem("access_token")}`
            }
        })
            .then(response => {
                if (response.ok) {
                    alert("Аудио успешно загружено");
                }
                else {
                    return response.json().then(err => { // Parse JSON error response
                        throw new Error(err.detail || 'Ошибка загрузки аудио');
                    });
                }
            })
            .catch(error => { // Catch errors from fetch and JSON parsing
                alert("Аудио загрузилось с ошибкой: " + error.message);
                console.error("Upload error:", error); // Log error to console for debugging
            });
    };
</script>